# Данный гайд создал под EXPRESS версию на ВИНДУ, где нет автоматических бекапов


## Гайд для локальных бекапов
1. Заходим в MS SQL, создаем sql-запрос
В нем: @pathName - путь, куда и что сохранять. В моем случае это путь C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\Backup\SQL SERVER\, создается файл под названием MY-DB_SQLSERVER_ДАТА
Затем в этом же запросе выполняется бекап (BACKUP DATABASE)
Выполняем запрос и смотрим, работает ли он как надо

Если вам не нужна автоматика, а хотите запускать ручками, то тут можно и закончить

2. Создаем сначала просто текстовый файл
Указываем к какому sql-запросу мы стучимся

Опционально: Пишем путь до программы-архиватора (в моем случае 7z)
А также пишем, в каком месте мы создаем архив и с какими файлами внутри (-tzip)
После создания архива удаляется созданный файлик от sql-запроса (del)

Наконец, текстовый файл переименовываем в расширение .bat
Выполняем (просто кликаем мышкой) и смотрим, работает ли он как надо

3. Ищем "Планировщик задач"
Жмем "создать простую задачу", называем как хотим, это никак не влияет на работу бекапа
Во вкладке "триггеры" указать время и переодичность (например ежедневно в 17:00)
САМОЕ ВАЖНОЕ: вкладка "действия", в нем создаем действие "запуск программы" и выбираем наш батник 
Опционально: Во вкладке "Параметры" поставил галочки на "немедленно запускать задачу, если пропущен плановый запуск", "выполнять задачу по требованию" и "при сбое выполнения перезапускать через 1 мин"

## Гайд для сетевых бекапов
А вот тут уже сложнее
В качестве сетевого диска я по SMB подключился к диску на Linux (на Linux стоит Samba)
Айпишник Linux: 192.168.56.101
Подготовка к бекапу:
1. В Linux создаем папку
2. В графическом интерфейсе Samba (на Astra Linux он находится в панели управления > сеть) указываю эту папку как общую.
3. В настройках Samba у папки выбираем нужные нам параметры:
   + режим доступа > чтение/запись
   + доступ > доступ только выбранным пользователям самбы
   + добавить созданных заранее разрешенных пользователей
4. Не забываем настроить межсетевой экран/брендмаузер
5. На Windows:
   + Открыть раздел "этот компьютер" > сверху будет вкладка "компьютер" > "подключить сетевой диск"
   + Прописываем "\\192.168.56.101\путь_до_папки" > назвать эту папку как хочется, пусть будет "SMBfold"
   + Если всё ок настроено, то значит мы молодцы и сетевая папка готова

Теперь к делу:
Если шаг ниже не сделать, то будет грустно
Для начала заходим в MS SQL и создаем новый пустой запрос, прописываем:

```
EXEC sp_configure 'show advanced options', 1;
GO
RECONFIGURE;
GO

EXEC sp_configure 'xp_cmdshell',1
GO
RECONFIGURE
GO
```

Если все прошло хорошо приступаем непосредственно к подключению диска:
Это если у нас нет авторизации:

```
EXEC XP_CMDSHELL 'net use v: \\192.168.56.101\SMBfold'
```
Если есть:
```
EXEC XP_CMDSHELL 'net use v: \\192.168.56.101\SMBfold /user:UserName Password'
```

для проверки что все прошло хорошо можно выполнить запрос
```
EXEC XP_CMDSHELL 'Dir v:'
```
